INFLATION <- data.frame(fromJSON(getURL(URLencode('skipper.cs.utexas.edu:5001/rest/native/?query="select * from INFLATION"'),httpheader=c(DB='jdbc:oracle:thin:@sayonara.microlab.cs.utexas.edu:1521:orcl', USER='C##cs329e_riw223', PASS='orcl_riw223', MODE='native_mode', MODEL='model', returnDimensions = 'False', returnFor = 'JSON'), verbose = TRUE), ))


df1 <- NHCE %>% select(COUNTRYGROUP,CODE,ITEM,STATE_NAME,Y1980,Y1981,Y1982,Y1983,Y1984,Y1985,Y1986,Y1987,Y1988,Y1989,Y1990,Y1991,Y1992,Y1993,Y1994,Y1995,Y1996,Y1997,Y1998,Y1999,Y2000,Y2001,Y2002,Y2003,Y2004,Y2005,Y2006,Y2007,Y2008,Y2009,AVERAGE_ANNUAL_PERCENT_GROWTH) %>% mutate(Y1980IN = Y1980,Y1981IN = Y1980IN * (1 + (0.01 * INFLATION[1,2])),Y1982IN = Y1981IN * (1 + (0.01 * INFLATION[2,2])),Y1983IN = Y1982IN * (1 + (0.01 * INFLATION[3,2])),Y1984IN = Y1983IN * (1 + (0.01 * INFLATION[4,2])),Y1985IN = Y1984IN * (1 + (0.01 * INFLATION[5,2])),Y1986IN = Y1985IN * (1 + (0.01 * INFLATION[6,2])),Y1987IN = Y1986IN * (1 + (0.01 * INFLATION[7,2])),Y1988IN = Y1987IN * (1 + (0.01 * INFLATION[8,2])),Y1989IN = Y1988IN * (1 + (0.01 * INFLATION[9,2])),Y1990IN = Y1989IN * (1 + (0.01 * INFLATION[10,2])),Y1991IN = Y1990IN * (1 + (0.01 * INFLATION[11,2])),Y1992IN = Y1991IN * (1 + (0.01 * INFLATION[12,2])),Y1993IN = Y1992IN * (1 + (0.01 * INFLATION[13,2])),Y1994IN = Y1993IN * (1 + (0.01 * INFLATION[14,2])),Y1995IN = Y1994IN * (1 + (0.01 * INFLATION[15,2])),Y1996IN = Y1995IN * (1 + (0.01 * INFLATION[16,2])),Y1997IN = Y1996IN * (1 + (0.01 * INFLATION[17,2])),Y1998IN = Y1997IN * (1 + (0.01 * INFLATION[18,2])),Y1999IN = Y1998IN * (1 + (0.01 * INFLATION[19,2])),Y2000IN = Y1999IN * (1 + (0.01 * INFLATION[20,2])),Y2001IN = Y2000IN * (1 + (0.01 * INFLATION[21,2])),Y2002IN = Y2001IN * (1 + (0.01 * INFLATION[22,2])),Y2003IN = Y2002IN * (1 + (0.01 * INFLATION[23,2])),Y2004IN = Y2003IN * (1 + (0.01 * INFLATION[24,2])),Y2005IN = Y2004IN * (1 + (0.01 * INFLATION[25,2])),Y2006IN = Y2005IN * (1 + (0.01 * INFLATION[26,2])),Y2007IN = Y2006IN * (1 + (0.01 * INFLATION[27,2])),Y2008IN = Y2007IN * (1 + (0.01 * INFLATION[28,2])),Y2009IN = Y2008IN * (1 + (0.01 * INFLATION[29,2])))  %>% filter(STATE_NAME == "Texas",CODE != '12') %>% select(ITEM,Y1980,Y1980IN,Y1981,Y1981IN,Y1982,Y1982IN,Y1983,Y1983IN,Y1984,Y1984IN,Y1985,Y1985IN,Y1986,Y1986IN,Y1987,Y1987IN,Y1988,Y1988IN,Y1989,Y1989IN,Y1990,Y1990IN,Y1991,Y1991IN,Y1992,Y1992IN,Y1993,Y1993IN,Y1994,Y1994IN,Y1995,Y1995IN,Y1996,Y1996IN,Y1997,Y1997IN,Y1998,Y1998IN,Y1999,Y1999IN,Y2000,Y2000IN,Y2001,Y2001IN,Y2002,Y2002IN,Y2003,Y2003IN,Y2004,Y2004IN,Y2005,Y2005IN,Y2006,Y2006IN,Y2007,Y2007IN,Y2008,Y2008IN,Y2009,Y2009IN,AVERAGE_ANNUAL_PERCENT_GROWTH)%>% melt(id.var = "ITEM")



ggplot () + 
  coord_cartesian() +
  scale_x_discrete() +
  scale_y_continuous() +
  labs(title = 'Annual Healthcare Expenditure in Texas by Service Type',x='Year',y='Spending') +
  layer(data = df1, 
        mapping = aes(x = variable, y =value, fill = ITEM), 
        stat = 'identity',
        geom = 'bar') + 
  theme(axis.text.x = element_text(angle = 45,size = 10))


